# 🚀 智能客服系统升级版 - 项目启动指南

## 📋 项目概述

本项目是基于现有智能客服系统的全面升级版本，集成了AutoGen智能体框架、多模态大模型、Milvus向量数据库等先进技术，提供企业级的智能客服解决方案。

## 🛠️ 环境要求

### 基础环境
- **Python**: 3.11+
- **Node.js**: 18.0+
- **Docker**: 20.0+ (可选)
- **Git**: 2.30+

### 数据库环境
- **MySQL**: 8.0+ (生产环境)
- **SQLite**: 3.35+ (开发环境)
- **Milvus**: 2.3+
- **Neo4j**: 5.0+
- **Redis**: 7.0+

### 硬件要求
- **内存**: 最低8GB，推荐16GB+
- **存储**: 最低50GB可用空间
- **GPU**: 可选，用于本地模型推理加速

## 📦 快速开始

### 1. 克隆项目
```bash
cd D:/ai-training-course/IntelligentCustomerService
git pull origin main  # 更新到最新版本
```

### 2. 环境配置

#### 方法一：使用uv（推荐）
```bash
# 安装uv包管理器
pip install uv

# 创建虚拟环境
uv venv venv

# 激活虚拟环境
# Windows
.\venv\Scripts\activate
# Linux/Mac
source venv/bin/activate

# 安装依赖
uv pip install -r requirements-upgrade.txt
```

#### 方法二：使用pip
```bash
# 创建虚拟环境
python -m venv venv

# 激活虚拟环境
# Windows
.\venv\Scripts\activate
# Linux/Mac
source venv/bin/activate

# 升级pip
pip install --upgrade pip

# 安装依赖
pip install -r requirements-upgrade.txt
```

### 3. 数据库配置

#### 3.1 MySQL配置（生产环境）
```bash
# 创建数据库
mysql -u root -p
CREATE DATABASE intelligent_customer_service CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'ics_user'@'localhost' IDENTIFIED BY 'your_password';
GRANT ALL PRIVILEGES ON intelligent_customer_service.* TO 'ics_user'@'localhost';
FLUSH PRIVILEGES;
```

#### 3.2 Milvus配置
```bash
# 使用Docker启动Milvus
docker run -d --name milvus-standalone \
  -p 19530:19530 \
  -p 9091:9091 \
  -v milvus_data:/var/lib/milvus \
  milvusdb/milvus:v2.3.0 \
  milvus run standalone
```

#### 3.3 Neo4j配置
```bash
# 使用Docker启动Neo4j
docker run -d --name neo4j \
  -p 7474:7474 -p 7687:7687 \
  -e NEO4J_AUTH=neo4j/your_password \
  -v neo4j_data:/data \
  neo4j:5.0
```

#### 3.4 Redis配置
```bash
# 使用Docker启动Redis
docker run -d --name redis \
  -p 6379:6379 \
  -v redis_data:/data \
  redis:7.0 redis-server --appendonly yes
```

### 4. 环境变量配置

创建 `.env` 文件：
```bash
# 复制环境变量模板
cp .env.example .env
```

编辑 `.env` 文件：
```env
# 应用配置
APP_NAME=智能客服系统升级版
APP_VERSION=2.0.0
DEBUG=True
SECRET_KEY=your_secret_key_here

# 数据库配置
DATABASE_URL=mysql://ics_user:your_password@localhost:3306/intelligent_customer_service
SQLITE_URL=sqlite:///./app.db

# Milvus配置
MILVUS_HOST=localhost
MILVUS_PORT=19530
MILVUS_USER=
MILVUS_PASSWORD=

# Neo4j配置
NEO4J_URI=bolt://localhost:7687
NEO4J_USER=neo4j
NEO4J_PASSWORD=your_password

# Redis配置
REDIS_URL=redis://localhost:6379/0

# 模型API配置
DEEPSEEK_API_KEY=your_deepseek_api_key
DEEPSEEK_BASE_URL=https://api.deepseek.com/v1

QWEN_API_KEY=your_qwen_api_key
QWEN_BASE_URL=https://dashscope.aliyuncs.com/compatible-mode/v1

# ModelScope配置
MODELSCOPE_CACHE_DIR=./models
MODELSCOPE_TOKEN=your_modelscope_token

# 日志配置
LOG_LEVEL=INFO
LOG_FILE=./logs/app.log
```

### 5. 数据库初始化

```bash
# 运行数据库迁移
python -m aerich init -t app.settings.TORTOISE_ORM
python -m aerich init-db
python -m aerich migrate
python -m aerich upgrade

# 初始化向量数据库
python scripts/init_vector_db.py

# 初始化图数据库
python scripts/init_graph_db.py
```

### 6. 模型下载和配置

```bash
# 下载嵌入模型和重排模型
python scripts/download_models.py

# 验证模型配置
python scripts/verify_models.py
```

### 7. 启动服务

#### 开发环境
```bash
# 启动后端服务
python run.py

# 或使用uvicorn
uvicorn app.main:app --host 0.0.0.0 --port 9999 --reload
```

#### 生产环境
```bash
# 使用gunicorn启动
gunicorn app.main:app -w 4 -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:9999
```

### 8. 前端启动

#### Vue3管理后台
```bash
cd web
pnpm install
pnpm dev
```

#### React聊天界面
```bash
cd web-react
pnpm install
pnpm dev
```

## 🔧 配置说明

### 模型配置

在 `app/settings/model_config.py` 中配置模型参数：

```python
MODEL_CONFIG = {
    "llm_models": {
        "deepseek-chat": {
            "api_key": "your_api_key",
            "base_url": "https://api.deepseek.com/v1",
            "default_params": {
                "temperature": 0.7,
                "max_tokens": 2048
            }
        }
    },
    "multimodal_models": {
        "qwen-vl-max": {
            "api_key": "your_api_key", 
            "base_url": "https://dashscope.aliyuncs.com/compatible-mode/v1"
        }
    },
    "embedding_models": {
        "qwen3-0.6b": {
            "model_name": "Qwen/Qwen3-0.6B",
            "cache_dir": "./models",
            "device": "cpu"  # 或 "cuda"
        }
    },
    "rerank_models": {
        "qwen3-reranker": {
            "model_name": "Qwen/Qwen3-Reranker-0.6B",
            "cache_dir": "./models",
            "device": "cpu"
        }
    }
}
```

### 智能体配置

在 `app/settings/agent_config.py` 中配置智能体参数：

```python
AGENT_CONFIG = {
    "chat_agent": {
        "system_message": "你是一个专业的智能客服助手...",
        "max_history_length": 20,
        "temperature": 0.7
    },
    "knowledge_agent": {
        "search_top_k": 5,
        "rerank_top_k": 3,
        "similarity_threshold": 0.7
    },
    "tool_agent": {
        "enabled_tools": ["ecommerce", "search", "file"],
        "timeout": 30
    }
}
```

## 🧪 测试验证

### 1. 健康检查
```bash
# 检查所有服务状态
curl http://localhost:9999/api/v1/health

# 检查模型服务
curl http://localhost:9999/api/v1/models/health

# 检查向量数据库
curl http://localhost:9999/api/v1/knowledge/health
```

### 2. 功能测试
```bash
# 测试聊天接口
curl -X POST http://localhost:9999/api/v1/chat/chat \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer your_token" \
  -d '{"message": "你好，我想了解一下产品信息"}'

# 测试流式聊天
curl -X POST http://localhost:9999/api/v1/chat/stream \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer your_token" \
  -d '{"message": "你好", "stream": true}'
```

### 3. 运行测试套件
```bash
# 运行单元测试
pytest tests/unit/

# 运行集成测试
pytest tests/integration/

# 运行端到端测试
pytest tests/e2e/
```

## 📊 监控和日志

### 日志查看
```bash
# 查看应用日志
tail -f logs/app.log

# 查看错误日志
tail -f logs/error.log

# 查看访问日志
tail -f logs/access.log
```

### 性能监控
- 访问 http://localhost:9999/metrics 查看Prometheus指标
- 使用Grafana配置监控面板
- 查看数据库性能指标

## 🚨 故障排除

### 常见问题

1. **模型下载失败**
   ```bash
   # 检查网络连接
   ping modelscope.cn
   
   # 手动下载模型
   python scripts/download_models.py --force
   ```

2. **数据库连接失败**
   ```bash
   # 检查数据库服务状态
   systemctl status mysql
   systemctl status redis
   docker ps | grep milvus
   ```

3. **内存不足**
   ```bash
   # 调整模型配置，使用CPU而非GPU
   # 减少并发数量
   # 增加虚拟内存
   ```

4. **端口冲突**
   ```bash
   # 检查端口占用
   netstat -tulpn | grep :9999
   
   # 修改配置文件中的端口
   ```

### 日志级别调整
```python
# 在.env文件中设置
LOG_LEVEL=DEBUG  # 开发环境
LOG_LEVEL=INFO   # 生产环境
LOG_LEVEL=ERROR  # 仅错误日志
```

## 📚 更多资源

- [API文档](http://localhost:9999/docs)
- [架构设计文档](智能客服系统完整架构设计方案.md)
- [工作计划](详细分阶段工作计划.md)
- [开发指南](./docs/development-guide.md)
- [部署指南](./docs/deployment-guide.md)

## 🤝 技术支持

如果在启动过程中遇到问题，请：

1. 查看日志文件获取详细错误信息
2. 检查环境配置是否正确
3. 确认所有依赖服务正常运行
4. 参考故障排除章节
5. 联系技术支持团队

---

**注意**: 这是升级版系统，请确保在生产环境部署前进行充分测试。
