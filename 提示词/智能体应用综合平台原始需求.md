项目：智能体综合应用平台 - 详细需求规格说明

---

### 一、 项目愿景与目标

**1.1 项目愿景**
打造一个集成了前沿AI技术、具备高度可扩展性和模块化能力的“一站式”智能体解决方案平台。该平台旨在成为企业数字化转型的核心引擎，通过赋能员工、优化流程和革新客户交互方式，显著提升企业运营效率与核心竞争力。

**1.2 核心目标**
* 功能集成化: 在统一平台内提供覆盖客服、数据洞察、知识管理、内容创作四大核心业务场景的智能化服务。
* 技术先进性: 采用业界领先的智能体（Agent）、大语言模型（LLM）和检索增强生成（RAG）技术，确保方案的先进性和有效性。
* 用户体验至上: 提供现代化、直观、响应迅速的前端界面，特别是无缝的流式对话体验，降低用户使用门槛。
* 安全与可管理性: 构建强大而精细的后台管理系统，确保企业数据的安全、可控与可追溯。

**1.3 目标用户画像**
* 企业管理员: 负责平台的整体配置、用户权限分配、知识库维护和系统监控。
* 业务运营/市场人员: 主要使用“Text2SQL数据分析智能体”获取业务洞察，使用“文案创作智能体”生成营销材料。
* 客服团队/支持工程师: 使用和监控“智能客服智能体”，处理升级的复杂问题，并利用“企业知识库”解答内部疑问。
* 普通员工: 将“企业知识库”作为日常工作的查询助手，获取公司规章、产品资料等信息。
* 外部客户/网站访客: 与部署在企业官网或App上的“智能客服智能体”进行交互。

---

### 二、 整体技术架构与设计原则

**2.1 四层架构模型**
1.  表现层 (Presentation Layer):
    * 技术: Vue.js 3 + TypeScript + Vite + Element-Plus/Ant Design Vue。
    * 职责: 负责所有用户界面的渲染与交互。构建为响应式单页应用（SPA），适配主流桌面浏览器。
2.  服务与API层 (Service & API Layer):
    * 技术: Python 3.11+ + FastAPI。
    * 职责: 平台的核心业务逻辑。提供遵循RESTful规范的安全API接口，处理所有前端请求，并作为连接表现层与AI核心层的桥梁。所有对话类接口必须支持WebSocket或SSE (Server-Sent Events)实现流式输出。
3.  智能体与AI核心层 (Agent & AI Core Layer):
    * 技术: Autogen 框架，集成各类大语言模型（如 GPT-4o, Gemini, DeepSeek 等）。
    * 职责: 智能体（Agent）的定义、编排与执行。管理智能体的记忆（Memory）、工具（Tools）调用以及与LLM的交互。
4.  数据持久化层 (Data Persistence Layer):
    * 关系型数据库 (MySQL 8.x): 存储用户信息、角色权限、会话日志、知识库与文件元数据、应用配置等。
    * 向量数据库 (Milvus): 存储所有经过分块和向量化的知识片段，支撑RAG检索。
    * 对象存储 (Minio): 存储用户上传的原始文件，如PDF、DOCX、PPTX、PNG、JPG等。

**2.2 核心设计原则**
* 模块化: 各智能体功能和后台模块应高度解耦，便于独立开发、测试、部署和升级。
* 可扩展性: 架构设计应能方便地横向扩展服务实例，并能轻松集成新的智能体或第三方工具。
* 安全性:
    * 实施基于角色的访问控制（RBAC）。
    * 所有API需通过JWT (JSON Web Token) 进行认证与授权。
    * 对敏感数据进行加密存储。
    * 严格隔离不同租户或用户的私有知识库数据。

---

### 三、 前端详细功能需求

**3.1 通用界面要求**
* 设计风格: 现代、简洁、科技感，参考OpenAI、Anthropic等一线AI公司官网，使用统一的UI组件库，确保视觉一致性。
* 交互: 关键操作有即时反馈，加载状态有明确指示（如骨架屏、加载动画），对话界面响应流畅。

**3.2 智能客服智能体界面**
* 聊天窗口:
    * 支持Markdown格式消息渲染（加粗、列表、链接、代码块）。
    * 支持图片上传（拖拽或点击选择）和展示。
    * 每条AI回复旁应有“复制”按钮和“赞/踩”反馈按钮。
    * 清晰展示消息来源（用户头像/AI头像）。
    * 当AI调用工具时，可显示“正在查询订单信息…”等中间状态提示。
* 会话管理: 左侧栏展示历史会话列表，支持创建新会话、删除和重命名会话。

**3.3 Text2SQL数据分析智能体界面**
* 三栏式布局:
    * 左侧 (输入区): 用户输入自然语言问题。提供常用查询示例。
    * 中间 (处理结果区): 两个标签页。Tab1显示模型生成的SQL查询语句及对应的自然语言解释。Tab2显示从数据库查询返回的原始数据表格，支持排序和分页。
    * 右侧 (可视化区): 根据查询结果动态生成交互式图表（如柱状图、折线图、饼图）。用户可选择图表类型，并能将图表导出为图片。
* 功能: 支持保存常用查询、查看历史查询记录、导出数据表格为CSV文件。

**3.4 企业知识库问答与文案创作界面**
* 知识库问答: 与智能客服界面类似。在AI回答下方，应明确标注引用来源，并提供可点击的链接，指向原始文档的具体片段或页码，增强答案的可信度。
* 文案创作:
    * 输入表单: 提供结构化输入字段，如“创作主题”、“目标受众”、“期望风格”（如专业、风趣）、“关键词”、“字数限制”等。
    * 模板选择: 提供下拉菜单选择预设的文案模板（如“社交媒体帖子”、“产品介绍”、“新闻稿”）。
    * 输出区域: 展示生成的文案，提供“重新生成”、“优化（追问）”、“复制内容”、“下载为.md/.txt文件”等快捷操作。

---

### 四、 后端与管理系统详细需求

**4.1 API设计规范**
* 认证: 所有需授权的API端点均通过请求头中的`Authorization: Bearer <JWT>`进行验证。
* 请求/响应: 请求体和响应体统一使用JSON格式，遵循驼峰命名法。
* 错误处理: 定义统一的错误码和错误信息结构，便于前端处理。例如: `{ "code": 40401, "message": "Knowledge base not found." }`。
* 文档: 自动生成并提供交互式API文档（通过FastAPI的Swagger UI和ReDoc）。

**4.2 后台管理系统功能**
* 仪表盘:
    * 系统状态监控：各服务（API、数据库、Minio）的实时健康状况。
    * 核心指标统计：过去24小时/7天/30天的API调用量、各智能体使用频率、活跃用户数、知识库文档数量等。
* 用户管理:
    * 完整的用户CRUD操作。
    * 分配角色（`admin`, `user`等），不同角色对应不同菜单和操作权限。
    * 支持批量导入用户、禁用/启用账户。
* 知识库管理:
    * 列表视图: 展示所有知识库，可按名称、类型（公共/私有）、创建者进行搜索和筛选。
    * 创建/编辑: 表单化创建或修改知识库，定义其名称、描述和类型。
    * 文件管理视图:
        * 查看指定知识库内的所有文件列表，包含文件名、格式、大小、上传时间、处理状态（排队中、处理中、完成、失败）。
        * 对处理失败的文件，提供“重试”按钮。
        * 支持单个或批量删除文件（删除后需同步删除Minio中的源文件和Milvus中的相关向量）。
        * 提供文件上传接口。

**4.3 核心处理流程（文件入库RAG）**
1.  接收文件: API接收到上传文件后，立即将其存入Minio，并在MySQL的`files`表中创建一条记录，状态标记为“排队中”。同时，将该文件ID推入一个后台任务队列（如Celery+Redis）。
2.  异步任务消费: 一个或多个独立的Worker进程持续从队列中获取任务。
3.  内容解析(marker): Worker根据文件类型调用marker将PDF/DOCX等转换为高质量的Markdown文本。若是图片，则调用多模态LLM的OCR或图像理解能力提取文字。
4.  语义分块: 将Markdown文本按照标题层级或固定Token大小（带重叠）进行语义切分，形成文档块（Chunks）。
5.  向量化与存储: 调用指定的嵌入模型（Embedding Model）将每个Chunk转换为向量，然后将Chunk文本内容、向量以及文件来源等元数据一同存入Milvus中。
6.  状态更新: 任务处理完成后，根据结果更新MySQL中对应文件的状态为“完成”或“失败”（并记录失败原因）。

**4.4 智能体（Agent）工作流设计**
* 意图识别: 用户的首次提问会先由一个`RouterAgent`或通过特定的提示词工程进行意图识别，判断其属于哪个领域（闲聊、知识库问答、工具调用、数据分析）。
* 工具调用工作流:
    1.  `PlanningAgent`分析用户需求，确定需要调用哪个或哪些工具。
    2.  `ToolCallingAgent`根据计划，生成符合Pydantic模型定义的参数，并执行工具（即调用相应的Python函数）。
    3.  `SummarizingAgent`整合工具返回的结果，形成自然语言的最终答复。
* RAG问答工作流:
    1.  `QueryExpansionAgent`对用户原始问题进行改写或扩展，以提升召回率。
    2.  `RetrieverAgent`携带改写后的查询，从Milvus中检索出Top-K个最相关的文本块。
    3.  （可选高级步骤）`RerankingAgent`使用更精密的模型对召回的文本块进行重排序。
    4.  `AnsweringAgent`将原始问题、排序后的上下文文本块、聊天历史一并提交给LLM，生成最终的、有理有据的回答。