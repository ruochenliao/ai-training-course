# ä¼ä¸šRAGç³»ç»Ÿå‰åç«¯æ¥å£è”è°ƒæŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†ä¼ä¸šRAGç³»ç»Ÿå‰åç«¯æ¥å£çš„è”è°ƒæ–¹æ³•ã€æµ‹è¯•æµç¨‹å’Œå¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆã€‚

## ğŸ¯ æ¥å£æ¶æ„æ¦‚è§ˆ

### å‰ç«¯æ¶æ„
- **æ¡†æ¶**: Next.js 14 + TypeScript
- **UIåº“**: Ant Design 5.x
- **çŠ¶æ€ç®¡ç†**: React Context + TanStack Query
- **HTTPå®¢æˆ·ç«¯**: Axios

### åç«¯æ¶æ„
- **æ¡†æ¶**: FastAPI + Python 3.11
- **APIç‰ˆæœ¬**: v1 (`/api/v1/`)
- **è®¤è¯æ–¹å¼**: JWT Bearer Token
- **æ–‡æ¡£åœ°å€**: http://localhost:8000/docs

## ğŸ”— å®Œæ•´æ¥å£æ¸…å•

### 1. è®¤è¯æˆæƒæ¥å£ (`/api/v1/auth/`)

| æ–¹æ³• | ç«¯ç‚¹ | æè¿° | å‰ç«¯æ–¹æ³• |
|------|------|------|----------|
| POST | `/auth/login` | è¡¨å•ç™»å½• | `apiClient.login()` |
| POST | `/auth/login/json` | JSONç™»å½• | `apiClient.loginJson()` |
| POST | `/auth/register` | ç”¨æˆ·æ³¨å†Œ | `apiClient.register()` |
| POST | `/auth/logout` | ç”¨æˆ·ç™»å‡º | `apiClient.logout()` |
| GET | `/auth/me` | è·å–å½“å‰ç”¨æˆ· | `apiClient.getCurrentUser()` |
| POST | `/auth/refresh` | åˆ·æ–°ä»¤ç‰Œ | `apiClient.refreshToken()` |

### 2. èŠå¤©å¯¹è¯æ¥å£ (`/api/v1/chat/`, `/api/v1/conversations/`)

| æ–¹æ³• | ç«¯ç‚¹ | æè¿° | å‰ç«¯æ–¹æ³• |
|------|------|------|----------|
| POST | `/chat/` | å‘é€æ¶ˆæ¯ | `apiClient.sendChatMessage()` |
| POST | `/chat/stream` | æµå¼èŠå¤© | `apiClient.streamChatMessage()` |
| GET | `/conversations/` | è·å–å¯¹è¯åˆ—è¡¨ | `apiClient.getConversations()` |
| GET | `/conversations/{id}` | è·å–å¯¹è¯è¯¦æƒ… | `apiClient.getConversation()` |
| GET | `/conversations/{id}/messages` | è·å–å¯¹è¯æ¶ˆæ¯ | `apiClient.getMessages()` |
| DELETE | `/conversations/{id}` | åˆ é™¤å¯¹è¯ | `apiClient.deleteConversation()` |

### 3. çŸ¥è¯†åº“ç®¡ç†æ¥å£ (`/api/v1/knowledge-bases/`)

| æ–¹æ³• | ç«¯ç‚¹ | æè¿° | å‰ç«¯æ–¹æ³• |
|------|------|------|----------|
| GET | `/knowledge-bases/` | è·å–çŸ¥è¯†åº“åˆ—è¡¨ | `apiClient.getKnowledgeBases()` |
| POST | `/knowledge-bases/` | åˆ›å»ºçŸ¥è¯†åº“ | `apiClient.createKnowledgeBase()` |
| GET | `/knowledge-bases/{id}` | è·å–çŸ¥è¯†åº“è¯¦æƒ… | `apiClient.getKnowledgeBase()` |
| PUT | `/knowledge-bases/{id}` | æ›´æ–°çŸ¥è¯†åº“ | `apiClient.updateKnowledgeBase()` |
| DELETE | `/knowledge-bases/{id}` | åˆ é™¤çŸ¥è¯†åº“ | `apiClient.deleteKnowledgeBase()` |

### 4. æ–‡æ¡£ç®¡ç†æ¥å£ (`/api/v1/documents/`)

| æ–¹æ³• | ç«¯ç‚¹ | æè¿° | å‰ç«¯æ–¹æ³• |
|------|------|------|----------|
| GET | `/documents/` | è·å–æ–‡æ¡£åˆ—è¡¨ | `apiClient.getDocuments()` |
| POST | `/documents/upload` | ä¸Šä¼ æ–‡æ¡£ | `apiClient.uploadDocument()` |
| GET | `/documents/{id}` | è·å–æ–‡æ¡£è¯¦æƒ… | `apiClient.getDocument()` |
| DELETE | `/documents/{id}` | åˆ é™¤æ–‡æ¡£ | `apiClient.deleteDocument()` |
| GET | `/documents/{id}/chunks` | è·å–æ–‡æ¡£åˆ†å— | `apiClient.getDocumentChunks()` |
| POST | `/documents/batch-process` | æ‰¹é‡å¤„ç†æ–‡æ¡£ | `apiClient.batchProcessDocuments()` |
| POST | `/documents/search` | æœç´¢æ–‡æ¡£ | `apiClient.searchDocuments()` |

### 5. æœç´¢æ£€ç´¢æ¥å£ (`/api/v1/search/`)

| æ–¹æ³• | ç«¯ç‚¹ | æè¿° | å‰ç«¯æ–¹æ³• |
|------|------|------|----------|
| POST | `/search/vector` | å‘é‡æœç´¢ | `apiClient.vectorSearch()` |
| POST | `/search/graph` | å›¾è°±æœç´¢ | `apiClient.graphSearch()` |
| POST | `/search/hybrid` | æ··åˆæœç´¢ | `apiClient.hybridSearch()` |
| POST | `/advanced-search/` | é«˜çº§æœç´¢ | `apiClient.advancedSearch()` |

### 6. çŸ¥è¯†å›¾è°±æ¥å£ (`/api/v1/graph/`)

| æ–¹æ³• | ç«¯ç‚¹ | æè¿° | å‰ç«¯æ–¹æ³• |
|------|------|------|----------|
| GET | `/graph/visualize` | å›¾è°±å¯è§†åŒ– | `apiClient.getKnowledgeGraph()` |
| GET | `/graph/entities` | è·å–å®ä½“åˆ—è¡¨ | `apiClient.getGraphEntities()` |
| GET | `/graph/relations` | è·å–å…³ç³»åˆ—è¡¨ | `apiClient.getGraphRelations()` |
| GET | `/graph/stats` | å›¾è°±ç»Ÿè®¡ä¿¡æ¯ | - |

### 7. ç”¨æˆ·ç®¡ç†æ¥å£ (`/api/v1/users/`)

| æ–¹æ³• | ç«¯ç‚¹ | æè¿° | å‰ç«¯æ–¹æ³• |
|------|------|------|----------|
| GET | `/users/` | è·å–ç”¨æˆ·åˆ—è¡¨ | `apiClient.getUsers()` |
| POST | `/users/` | åˆ›å»ºç”¨æˆ· | `apiClient.createUser()` |
| PUT | `/users/{id}` | æ›´æ–°ç”¨æˆ· | `apiClient.updateUser()` |
| DELETE | `/users/{id}` | åˆ é™¤ç”¨æˆ· | `apiClient.deleteUser()` |

### 8. ç³»ç»Ÿç®¡ç†æ¥å£ (`/api/v1/admin/`, `/api/v1/system/`)

| æ–¹æ³• | ç«¯ç‚¹ | æè¿° | å‰ç«¯æ–¹æ³• |
|------|------|------|----------|
| GET | `/health` | ç³»ç»Ÿå¥åº·æ£€æŸ¥ | `apiClient.getSystemHealth()` |
| GET | `/system/info` | ç³»ç»Ÿä¿¡æ¯ | `apiClient.getSystemInfo()` |
| GET | `/admin/stats` | ç³»ç»Ÿç»Ÿè®¡ | `apiClient.getSystemStats()` |
| GET | `/admin/logs` | ç³»ç»Ÿæ—¥å¿— | `apiClient.getSystemLogs()` |

## ğŸš€ è”è°ƒå¯åŠ¨æ­¥éª¤

### 1. å¯åŠ¨åç«¯æœåŠ¡

```bash
# è¿›å…¥åç«¯ç›®å½•
cd enterprise-rag-system/backend

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# å¯åŠ¨æœåŠ¡
python -m app.main
# æˆ–è€…
uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

### 2. å¯åŠ¨å‰ç«¯æœåŠ¡

```bash
# è¿›å…¥å‰ç«¯ç›®å½•
cd enterprise-rag-system/frontend/unified-app

# å®‰è£…ä¾èµ–
pnpm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev
```

### 3. éªŒè¯æœåŠ¡çŠ¶æ€

- **åç«¯APIæ–‡æ¡£**: http://localhost:8000/docs
- **åç«¯å¥åº·æ£€æŸ¥**: http://localhost:8000/health
- **å‰ç«¯åº”ç”¨**: http://localhost:3000

## ğŸ§ª æ¥å£æµ‹è¯•æ–¹æ³•

### æ–¹æ³•1: ä½¿ç”¨å†…ç½®æµ‹è¯•å·¥å…·

è®¿é—®å‰ç«¯ç®¡ç†åå°çš„APIæµ‹è¯•é¡µé¢ï¼š
```
http://localhost:3000/admin/api-test
```

### æ–¹æ³•2: ä½¿ç”¨Pythonæµ‹è¯•è„šæœ¬

```bash
# è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
python test_api_integration.py

# æŒ‡å®šæµ‹è¯•å‚æ•°
python test_api_integration.py \
  --base-url http://localhost:8000 \
  --username admin \
  --password admin123 \
  --output test_report.json
```

### æ–¹æ³•3: ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·

1. æ‰“å¼€å‰ç«¯åº”ç”¨
2. æŒ‰F12æ‰“å¼€å¼€å‘è€…å·¥å…·
3. åˆ‡æ¢åˆ°Networkæ ‡ç­¾
4. æ‰§è¡Œå‰ç«¯æ“ä½œï¼Œè§‚å¯ŸAPIè¯·æ±‚

### æ–¹æ³•4: ä½¿ç”¨Postman/Insomnia

å¯¼å…¥APIæ–‡æ¡£ï¼š
```
http://localhost:8000/openapi.json
```

## ğŸ”§ å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### 1. CORSè·¨åŸŸé—®é¢˜

**é—®é¢˜**: å‰ç«¯è¯·æ±‚è¢«CORSç­–ç•¥é˜»æ­¢

**è§£å†³æ–¹æ¡ˆ**:
```python
# backend/app/main.py
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:3000"],  # å‰ç«¯åœ°å€
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

### 2. è®¤è¯Tokené—®é¢˜

**é—®é¢˜**: 401 Unauthorizedé”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥tokenæ˜¯å¦æ­£ç¡®è®¾ç½®
2. éªŒè¯tokenæ ¼å¼ï¼š`Bearer <token>`
3. ç¡®è®¤tokenæœªè¿‡æœŸ

```typescript
// å‰ç«¯è®¾ç½®token
apiClient.setToken(loginResponse.access_token);
```

### 3. æ¥å£è·¯å¾„ä¸åŒ¹é…

**é—®é¢˜**: 404 Not Foundé”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥APIè·¯å¾„æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤åç«¯è·¯ç”±æ˜¯å¦æ³¨å†Œ
3. éªŒè¯HTTPæ–¹æ³•æ˜¯å¦åŒ¹é…

### 4. æ•°æ®æ ¼å¼ä¸åŒ¹é…

**é—®é¢˜**: 422 Validation Error

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥è¯·æ±‚æ•°æ®æ ¼å¼
2. å¯¹æ¯”APIæ–‡æ¡£ä¸­çš„schema
3. éªŒè¯å¿…å¡«å­—æ®µ

### 5. ç½‘ç»œè¿æ¥é—®é¢˜

**é—®é¢˜**: Network Erroræˆ–è¶…æ—¶

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯åŠ¨
2. éªŒè¯ç«¯å£æ˜¯å¦æ­£ç¡®
3. ç¡®è®¤é˜²ç«å¢™è®¾ç½®

## ğŸ“Š æ€§èƒ½ç›‘æ§

### å“åº”æ—¶é—´ç›‘æ§

```typescript
// å‰ç«¯ç›‘æ§
const startTime = Date.now();
const response = await apiClient.someMethod();
const responseTime = Date.now() - startTime;
console.log(`APIå“åº”æ—¶é—´: ${responseTime}ms`);
```

### é”™è¯¯ç‡ç»Ÿè®¡

```typescript
// é”™è¯¯ç»Ÿè®¡
let totalRequests = 0;
let errorRequests = 0;

// åœ¨axiosæ‹¦æˆªå™¨ä¸­ç»Ÿè®¡
apiClient.interceptors.response.use(
  response => {
    totalRequests++;
    return response;
  },
  error => {
    totalRequests++;
    errorRequests++;
    console.log(`é”™è¯¯ç‡: ${(errorRequests/totalRequests*100).toFixed(2)}%`);
    return Promise.reject(error);
  }
);
```

## ğŸ”„ æŒç»­é›†æˆ

### è‡ªåŠ¨åŒ–æµ‹è¯•

```yaml
# .github/workflows/api-test.yml
name: API Integration Test
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Start Backend
        run: |
          cd backend
          pip install -r requirements.txt
          python -m app.main &
      - name: Run API Tests
        run: python test_api_integration.py
```

### æ¥å£æ–‡æ¡£åŒæ­¥

```bash
# ç”Ÿæˆæœ€æ–°APIæ–‡æ¡£
curl http://localhost:8000/openapi.json > docs/api-spec.json

# æ›´æ–°å‰ç«¯ç±»å‹å®šä¹‰
npx swagger-typescript-api -p docs/api-spec.json -o src/types/api.ts
```

## ğŸ“ æœ€ä½³å®è·µ

### 1. é”™è¯¯å¤„ç†

```typescript
// ç»Ÿä¸€é”™è¯¯å¤„ç†
try {
  const result = await apiClient.someMethod();
  return result;
} catch (error) {
  if (error.response?.status === 401) {
    // é‡æ–°ç™»å½•
    router.push('/login');
  } else {
    message.error(error.message || 'æ“ä½œå¤±è´¥');
  }
  throw error;
}
```

### 2. è¯·æ±‚é‡è¯•

```typescript
// è‡ªåŠ¨é‡è¯•æœºåˆ¶
const retryRequest = async (fn: Function, maxRetries = 3) => {
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await fn();
    } catch (error) {
      if (i === maxRetries - 1) throw error;
      await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1)));
    }
  }
};
```

### 3. ç¼“å­˜ç­–ç•¥

```typescript
// ä½¿ç”¨TanStack Queryç¼“å­˜
const { data, error, isLoading } = useQuery({
  queryKey: ['knowledge-bases'],
  queryFn: () => apiClient.getKnowledgeBases(),
  staleTime: 5 * 60 * 1000, // 5åˆ†é’Ÿ
});
```

## ğŸ¯ æ€»ç»“

é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨å¯ä»¥ï¼š

1. âœ… äº†è§£å®Œæ•´çš„APIæ¥å£æ¸…å•
2. âœ… æŒæ¡å‰åç«¯è”è°ƒæ–¹æ³•
3. âœ… ä½¿ç”¨å¤šç§æµ‹è¯•å·¥å…·éªŒè¯æ¥å£
4. âœ… è§£å†³å¸¸è§çš„è”è°ƒé—®é¢˜
5. âœ… å®æ–½æ€§èƒ½ç›‘æ§å’ŒæŒç»­é›†æˆ

ç¡®ä¿å‰åç«¯æ¥å£çš„ç¨³å®šæ€§å’Œä¸€è‡´æ€§ï¼Œä¸ºç”¨æˆ·æä¾›æµç•…çš„ä½¿ç”¨ä½“éªŒã€‚
