# å¯¹è¯ç®¡ç†æ¨¡å— API æ–‡æ¡£

## ğŸ“‹ æ¨¡å—æ¦‚è¿°

å¯¹è¯ç®¡ç†æ¨¡å—æä¾›å¯¹è¯çš„åˆ›å»ºã€æŸ¥è¯¢ã€ç®¡ç†å’Œæ¶ˆæ¯å†å²è®°å½•åŠŸèƒ½ï¼Œæ”¯æŒå¤šè½®å¯¹è¯å’Œä¸Šä¸‹æ–‡ç»´æŠ¤ã€‚

**åŸºç¡€è·¯å¾„**: `/api/v1/conversations`

## ğŸ’¬ åŠŸèƒ½ç‰¹æ€§

- **å¯¹è¯åˆ›å»º**: åˆ›å»ºæ–°çš„å¯¹è¯ä¼šè¯
- **æ¶ˆæ¯ç®¡ç†**: ç®¡ç†å¯¹è¯ä¸­çš„æ¶ˆæ¯è®°å½•
- **ä¸Šä¸‹æ–‡ç»´æŠ¤**: ä¿æŒå¯¹è¯çš„ä¸Šä¸‹æ–‡è¿ç»­æ€§
- **å¯¹è¯åˆ†ç±»**: æ”¯æŒå¯¹è¯çš„åˆ†ç±»å’Œæ ‡ç­¾
- **å†å²æŸ¥è¯¢**: æŸ¥è¯¢å†å²å¯¹è¯è®°å½•
- **å¯¹è¯ç»Ÿè®¡**: æä¾›å¯¹è¯ç›¸å…³çš„ç»Ÿè®¡ä¿¡æ¯

## ğŸ“š æ¥å£åˆ—è¡¨

### 1. è·å–å¯¹è¯åˆ—è¡¨

**æ¥å£åç§°**: è·å–å¯¹è¯åˆ—è¡¨  
**åŠŸèƒ½æè¿°**: è·å–å½“å‰ç”¨æˆ·çš„å¯¹è¯åˆ—è¡¨  
**æ¥å£åœ°å€**: `/api/v1/conversations/`  
**è¯·æ±‚æ–¹å¼**: GET  
**è®¤è¯**: éœ€è¦Bearer Token

#### è¯·æ±‚å‚æ•°
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-------|------|-----|------|--------|
| page | int | å¦ | é¡µç ï¼ˆé»˜è®¤1ï¼‰ | 1 |
| size | int | å¦ | æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤20ï¼Œæœ€å¤§100ï¼‰ | 20 |

#### å“åº”å‚æ•°
```json
{
  "conversations": [
    {
      "id": 1,
      "title": "å…³äºäººå·¥æ™ºèƒ½çš„è®¨è®º",
      "created_at": "2024-01-01T12:00:00Z",
      "updated_at": "2024-01-01T12:30:00Z",
      "message_count": 8
    },
    {
      "id": 2,
      "title": "æœºå™¨å­¦ä¹ ç®—æ³•å’¨è¯¢",
      "created_at": "2024-01-01T10:00:00Z",
      "updated_at": "2024-01-01T10:15:00Z",
      "message_count": 4
    }
  ],
  "total": 25,
  "page": 1,
  "size": 20
}
```

| å‚æ•°å | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-------|------|------|--------|
| conversations | array | å¯¹è¯åˆ—è¡¨ | è§å¯¹è¯å¯¹è±¡ |
| total | int | æ€»å¯¹è¯æ•° | 25 |
| page | int | å½“å‰é¡µç  | 1 |
| size | int | æ¯é¡µæ•°é‡ | 20 |

#### å¯¹è¯å¯¹è±¡å­—æ®µè¯´æ˜
| å‚æ•°å | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-------|------|------|--------|
| id | int | å¯¹è¯ID | 1 |
| title | string | å¯¹è¯æ ‡é¢˜ | å…³äºäººå·¥æ™ºèƒ½çš„è®¨è®º |
| created_at | string | åˆ›å»ºæ—¶é—´ | 2024-01-01T12:00:00Z |
| updated_at | string | æ›´æ–°æ—¶é—´ | 2024-01-01T12:30:00Z |
| message_count | int | æ¶ˆæ¯æ•°é‡ | 8 |

---

### 2. åˆ›å»ºå¯¹è¯

**æ¥å£åç§°**: åˆ›å»ºå¯¹è¯  
**åŠŸèƒ½æè¿°**: åˆ›å»ºæ–°çš„å¯¹è¯ä¼šè¯  
**æ¥å£åœ°å€**: `/api/v1/conversations/`  
**è¯·æ±‚æ–¹å¼**: POST  
**è®¤è¯**: éœ€è¦Bearer Token

#### è¯·æ±‚å‚æ•°
```json
{
  "title": "æ–°çš„å¯¹è¯"
}
```

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-------|------|-----|------|--------|
| title | string | å¦ | å¯¹è¯æ ‡é¢˜ï¼ˆé»˜è®¤"æ–°å¯¹è¯"ï¼‰ | æ–°çš„å¯¹è¯ |

#### å“åº”å‚æ•°
```json
{
  "id": 3,
  "title": "æ–°çš„å¯¹è¯",
  "created_at": "2024-01-01T13:00:00Z",
  "updated_at": "2024-01-01T13:00:00Z",
  "message_count": 0
}
```

---

### 3. è·å–å¯¹è¯è¯¦æƒ…

**æ¥å£åç§°**: è·å–å¯¹è¯è¯¦æƒ…  
**åŠŸèƒ½æè¿°**: è·å–æŒ‡å®šå¯¹è¯çš„è¯¦ç»†ä¿¡æ¯å’Œæ¶ˆæ¯å†å²  
**æ¥å£åœ°å€**: `/api/v1/conversations/{conversation_id}`  
**è¯·æ±‚æ–¹å¼**: GET  
**è®¤è¯**: éœ€è¦Bearer Token

#### è¯·æ±‚å‚æ•°
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-------|------|-----|------|--------|
| conversation_id | int | æ˜¯ | å¯¹è¯IDï¼ˆè·¯å¾„å‚æ•°ï¼‰ | 1 |

#### å“åº”å‚æ•°
```json
{
  "id": 1,
  "title": "å…³äºäººå·¥æ™ºèƒ½çš„è®¨è®º",
  "created_at": "2024-01-01T12:00:00Z",
  "updated_at": "2024-01-01T12:30:00Z",
  "messages": [
    {
      "id": 1,
      "role": "user",
      "content": "ä»€ä¹ˆæ˜¯äººå·¥æ™ºèƒ½ï¼Ÿ",
      "created_at": "2024-01-01T12:00:00Z",
      "metadata": {}
    },
    {
      "id": 2,
      "role": "assistant",
      "content": "äººå·¥æ™ºèƒ½ï¼ˆArtificial Intelligenceï¼ŒAIï¼‰æ˜¯æŒ‡ç”±æœºå™¨å±•ç°å‡ºçš„æ™ºèƒ½...",
      "created_at": "2024-01-01T12:00:05Z",
      "metadata": {
        "sources": [
          {
            "document_id": 1,
            "document_name": "AIåŸºç¡€çŸ¥è¯†.pdf",
            "score": 0.95
          }
        ],
        "processing_time": 2.3,
        "confidence": 0.92
      }
    }
  ]
}
```

| å‚æ•°å | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-------|------|------|--------|
| id | int | å¯¹è¯ID | 1 |
| title | string | å¯¹è¯æ ‡é¢˜ | å…³äºäººå·¥æ™ºèƒ½çš„è®¨è®º |
| created_at | string | åˆ›å»ºæ—¶é—´ | 2024-01-01T12:00:00Z |
| updated_at | string | æ›´æ–°æ—¶é—´ | 2024-01-01T12:30:00Z |
| messages | array | æ¶ˆæ¯åˆ—è¡¨ | è§æ¶ˆæ¯å¯¹è±¡ |

#### æ¶ˆæ¯å¯¹è±¡å­—æ®µè¯´æ˜
| å‚æ•°å | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-------|------|------|--------|
| id | int | æ¶ˆæ¯ID | 1 |
| role | string | è§’è‰²ï¼ˆuser/assistant/systemï¼‰ | user |
| content | string | æ¶ˆæ¯å†…å®¹ | ä»€ä¹ˆæ˜¯äººå·¥æ™ºèƒ½ï¼Ÿ |
| created_at | string | åˆ›å»ºæ—¶é—´ | 2024-01-01T12:00:00Z |
| metadata | object | æ¶ˆæ¯å…ƒæ•°æ® | è§å…ƒæ•°æ®å¯¹è±¡ |

---

### 4. æ›´æ–°å¯¹è¯æ ‡é¢˜

**æ¥å£åç§°**: æ›´æ–°å¯¹è¯æ ‡é¢˜  
**åŠŸèƒ½æè¿°**: æ›´æ–°æŒ‡å®šå¯¹è¯çš„æ ‡é¢˜  
**æ¥å£åœ°å€**: `/api/v1/conversations/{conversation_id}`  
**è¯·æ±‚æ–¹å¼**: PUT  
**è®¤è¯**: éœ€è¦Bearer Token

#### è¯·æ±‚å‚æ•°
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-------|------|-----|------|--------|
| conversation_id | int | æ˜¯ | å¯¹è¯IDï¼ˆè·¯å¾„å‚æ•°ï¼‰ | 1 |

```json
{
  "title": "æ›´æ–°åçš„å¯¹è¯æ ‡é¢˜"
}
```

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-------|------|-----|------|--------|
| title | string | æ˜¯ | æ–°çš„å¯¹è¯æ ‡é¢˜ | æ›´æ–°åçš„å¯¹è¯æ ‡é¢˜ |

#### å“åº”å‚æ•°
```json
{
  "id": 1,
  "title": "æ›´æ–°åçš„å¯¹è¯æ ‡é¢˜",
  "created_at": "2024-01-01T12:00:00Z",
  "updated_at": "2024-01-01T13:00:00Z",
  "message_count": 8
}
```

#### é”™è¯¯ç 
- `404`: å¯¹è¯ä¸å­˜åœ¨
- `403`: æ— æƒä¿®æ”¹æ­¤å¯¹è¯

---

### 5. åˆ é™¤å¯¹è¯

**æ¥å£åç§°**: åˆ é™¤å¯¹è¯  
**åŠŸèƒ½æè¿°**: åˆ é™¤æŒ‡å®šçš„å¯¹è¯åŠå…¶æ‰€æœ‰æ¶ˆæ¯  
**æ¥å£åœ°å€**: `/api/v1/conversations/{conversation_id}`  
**è¯·æ±‚æ–¹å¼**: DELETE  
**è®¤è¯**: éœ€è¦Bearer Token

#### è¯·æ±‚å‚æ•°
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-------|------|-----|------|--------|
| conversation_id | int | æ˜¯ | å¯¹è¯IDï¼ˆè·¯å¾„å‚æ•°ï¼‰ | 1 |

#### å“åº”å‚æ•°
```json
{
  "message": "å¯¹è¯å·²åˆ é™¤",
  "conversation_id": 1,
  "deleted_messages": 8
}
```

#### é”™è¯¯ç 
- `404`: å¯¹è¯ä¸å­˜åœ¨
- `403`: æ— æƒåˆ é™¤æ­¤å¯¹è¯

---

### 6. è·å–å¯¹è¯æ¶ˆæ¯

**æ¥å£åç§°**: è·å–å¯¹è¯æ¶ˆæ¯  
**åŠŸèƒ½æè¿°**: åˆ†é¡µè·å–æŒ‡å®šå¯¹è¯çš„æ¶ˆæ¯åˆ—è¡¨  
**æ¥å£åœ°å€**: `/api/v1/conversations/{conversation_id}/messages`  
**è¯·æ±‚æ–¹å¼**: GET  
**è®¤è¯**: éœ€è¦Bearer Token

#### è¯·æ±‚å‚æ•°
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-------|------|-----|------|--------|
| conversation_id | int | æ˜¯ | å¯¹è¯IDï¼ˆè·¯å¾„å‚æ•°ï¼‰ | 1 |
| page | int | å¦ | é¡µç ï¼ˆé»˜è®¤1ï¼‰ | 1 |
| size | int | å¦ | æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤50ï¼‰ | 50 |
| role | string | å¦ | è§’è‰²è¿‡æ»¤ | user |

#### å“åº”å‚æ•°
```json
{
  "conversation_id": 1,
  "messages": [
    {
      "id": 1,
      "role": "user",
      "content": "ä»€ä¹ˆæ˜¯äººå·¥æ™ºèƒ½ï¼Ÿ",
      "created_at": "2024-01-01T12:00:00Z",
      "metadata": {}
    }
  ],
  "total": 8,
  "page": 1,
  "size": 50
}
```

---

### 7. æœç´¢å¯¹è¯

**æ¥å£åç§°**: æœç´¢å¯¹è¯  
**åŠŸèƒ½æè¿°**: æ ¹æ®å…³é”®è¯æœç´¢å¯¹è¯  
**æ¥å£åœ°å€**: `/api/v1/conversations/search`  
**è¯·æ±‚æ–¹å¼**: GET  
**è®¤è¯**: éœ€è¦Bearer Token

#### è¯·æ±‚å‚æ•°
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-------|------|-----|------|--------|
| q | string | æ˜¯ | æœç´¢å…³é”®è¯ | äººå·¥æ™ºèƒ½ |
| page | int | å¦ | é¡µç  | 1 |
| size | int | å¦ | æ¯é¡µæ•°é‡ | 20 |

#### å“åº”å‚æ•°
```json
{
  "query": "äººå·¥æ™ºèƒ½",
  "conversations": [
    {
      "id": 1,
      "title": "å…³äºäººå·¥æ™ºèƒ½çš„è®¨è®º",
      "created_at": "2024-01-01T12:00:00Z",
      "updated_at": "2024-01-01T12:30:00Z",
      "message_count": 8,
      "highlights": [
        "å…³äº<em>äººå·¥æ™ºèƒ½</em>çš„è®¨è®º",
        "ä»€ä¹ˆæ˜¯<em>äººå·¥æ™ºèƒ½</em>ï¼Ÿ"
      ]
    }
  ],
  "total": 3,
  "page": 1,
  "size": 20
}
```

---

### 8. å¯¹è¯ç»Ÿè®¡

**æ¥å£åç§°**: è·å–å¯¹è¯ç»Ÿè®¡  
**åŠŸèƒ½æè¿°**: è·å–ç”¨æˆ·çš„å¯¹è¯ç»Ÿè®¡ä¿¡æ¯  
**æ¥å£åœ°å€**: `/api/v1/conversations/stats`  
**è¯·æ±‚æ–¹å¼**: GET  
**è®¤è¯**: éœ€è¦Bearer Token

#### è¯·æ±‚å‚æ•°
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-------|------|-----|------|--------|
| period | string | å¦ | ç»Ÿè®¡å‘¨æœŸï¼ˆday/week/monthï¼‰ | week |

#### å“åº”å‚æ•°
```json
{
  "period": "week",
  "total_conversations": 25,
  "total_messages": 150,
  "conversations_this_period": 5,
  "messages_this_period": 30,
  "average_messages_per_conversation": 6.0,
  "most_active_day": "2024-01-01",
  "conversation_topics": [
    {
      "topic": "äººå·¥æ™ºèƒ½",
      "count": 8
    },
    {
      "topic": "æœºå™¨å­¦ä¹ ",
      "count": 6
    }
  ]
}
```

## ğŸ”§ ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€å¯¹è¯ç®¡ç†
```bash
# 1. è·å–å¯¹è¯åˆ—è¡¨
curl -X GET "http://localhost:8000/api/v1/conversations/?page=1&size=20" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"

# 2. åˆ›å»ºæ–°å¯¹è¯
curl -X POST "http://localhost:8000/api/v1/conversations/" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "å…³äºæ·±åº¦å­¦ä¹ çš„è®¨è®º"
  }'

# 3. è·å–å¯¹è¯è¯¦æƒ…
curl -X GET "http://localhost:8000/api/v1/conversations/1" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"

# 4. æ›´æ–°å¯¹è¯æ ‡é¢˜
curl -X PUT "http://localhost:8000/api/v1/conversations/1" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "æ·±åº¦å­¦ä¹ æŠ€æœ¯æ¢è®¨"
  }'

# 5. åˆ é™¤å¯¹è¯
curl -X DELETE "http://localhost:8000/api/v1/conversations/1" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"
```

### å¯¹è¯æœç´¢å’Œç»Ÿè®¡
```bash
# æœç´¢å¯¹è¯
curl -X GET "http://localhost:8000/api/v1/conversations/search?q=äººå·¥æ™ºèƒ½&page=1&size=10" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"

# è·å–å¯¹è¯ç»Ÿè®¡
curl -X GET "http://localhost:8000/api/v1/conversations/stats?period=week" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"

# è·å–å¯¹è¯æ¶ˆæ¯
curl -X GET "http://localhost:8000/api/v1/conversations/1/messages?page=1&size=50" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"
```

## ğŸš¨ æ³¨æ„äº‹é¡¹

1. **æƒé™æ§åˆ¶**: ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„å¯¹è¯
2. **æ¶ˆæ¯é¡ºåº**: æ¶ˆæ¯æŒ‰æ—¶é—´é¡ºåºæ’åˆ—
3. **å¯¹è¯æ ‡é¢˜**: ç³»ç»Ÿä¼šæ ¹æ®é¦–æ¡æ¶ˆæ¯è‡ªåŠ¨ç”Ÿæˆæ ‡é¢˜
4. **åˆ é™¤æ“ä½œ**: åˆ é™¤å¯¹è¯ä¼šåŒæ—¶åˆ é™¤æ‰€æœ‰ç›¸å…³æ¶ˆæ¯
5. **æœç´¢åŠŸèƒ½**: æ”¯æŒå¯¹è¯æ ‡é¢˜å’Œæ¶ˆæ¯å†…å®¹çš„å…¨æ–‡æœç´¢
6. **åˆ†é¡µé™åˆ¶**: æ¶ˆæ¯åˆ—è¡¨å»ºè®®ä½¿ç”¨åˆ†é¡µé¿å…æ•°æ®é‡è¿‡å¤§
7. **ä¸Šä¸‹æ–‡ç»´æŠ¤**: ç³»ç»Ÿè‡ªåŠ¨ç»´æŠ¤å¯¹è¯çš„ä¸Šä¸‹æ–‡å…³ç³»
