# 企业级RAG系统接口标准化规范

## 概述

本文档定义了企业级RAG系统前后端接口的标准化规范，确保所有API接口使用统一的数据格式、命名规范和错误处理机制。

## 1. 响应格式标准

### 1.1 统一响应格式

所有API接口必须使用以下统一的响应格式：

```json
{
  "code": 200,
  "msg": "OK",
  "data": {}
}
```

### 1.2 字段说明

- **code**: 业务状态码（数字类型）
  - 200: 成功
  - 201: 创建成功
  - 400: 请求参数错误
  - 401: 未授权访问
  - 403: 权限不足
  - 404: 资源不存在
  - 500: 服务器内部错误

- **msg**: 响应消息（字符串类型）
  - 成功时：描述操作结果，如 "OK"、"创建成功"、"更新成功"
  - 失败时：描述错误原因，如 "参数错误"、"权限不足"

- **data**: 响应数据（任意类型）
  - 成功时：包含实际的业务数据
  - 失败时：可包含错误详情或为 null

### 1.3 分页响应格式

分页接口的 data 字段使用以下格式：

```json
{
  "code": 200,
  "msg": "OK",
  "data": {
    "items": [],
    "total": 100,
    "page": 1,
    "page_size": 20
  }
}
```

## 2. 命名规范

### 2.1 URL路径命名

- 使用小写字母和下划线
- 资源名称使用复数形式
- 层级关系清晰

```
✅ 正确示例:
/api/v1/rbac/departments/
/api/v1/rbac/user_roles/
/api/v1/knowledge_bases/

❌ 错误示例:
/api/v1/rbac/Department/
/api/v1/rbac/userRoles/
/api/v1/knowledgeBase/
```

### 2.2 字段命名

- 使用下划线命名法（snake_case）
- 字段名称具有描述性
- 布尔类型字段使用 is_ 前缀

```json
✅ 正确示例:
{
  "user_id": 123,
  "created_at": "2025-01-01T00:00:00Z",
  "is_active": true,
  "page_size": 20
}

❌ 错误示例:
{
  "userId": 123,
  "createdAt": "2025-01-01T00:00:00Z",
  "active": true,
  "pageSize": 20
}
```

### 2.3 参数命名

- 查询参数使用下划线命名
- 分页参数统一使用 page 和 page_size

```
✅ 正确示例:
GET /api/v1/users?page=1&page_size=20&search_keyword=admin

❌ 错误示例:
GET /api/v1/users?pageNum=1&pageSize=20&searchKeyword=admin
```

## 3. HTTP状态码规范

### 3.1 统一HTTP状态码

所有API响应的HTTP状态码统一为 200，业务状态通过响应体中的 code 字段表示。

### 3.2 业务状态码定义

| 状态码 | 含义 | 使用场景 |
|--------|------|----------|
| 200 | 成功 | 操作成功完成 |
| 201 | 创建成功 | 资源创建成功 |
| 400 | 请求参数错误 | 参数验证失败、格式错误 |
| 401 | 未授权访问 | 未登录、令牌无效 |
| 403 | 权限不足 | 已登录但无权限访问 |
| 404 | 资源不存在 | 请求的资源不存在 |
| 500 | 服务器内部错误 | 系统异常、数据库错误 |

## 4. 错误处理规范

### 4.1 错误响应格式

```json
{
  "code": 400,
  "msg": "参数错误",
  "data": {
    "field": "username",
    "detail": "用户名不能为空"
  }
}
```

### 4.2 错误消息规范

- 错误消息使用中文
- 消息内容具体明确
- 避免暴露系统内部信息

## 5. 认证和授权

### 5.1 认证头格式

```
Authorization: Bearer <access_token>
```

### 5.2 权限检查

所有需要权限的接口都应该：
- 验证用户身份
- 检查用户权限
- 返回统一的权限错误响应

## 6. 前端适配规范

### 6.1 HTTP客户端配置

前端HTTP客户端应该：
- 统一处理 {code, msg, data} 响应格式
- 自动添加认证头
- 统一错误处理和消息提示

### 6.2 类型定义

```typescript
interface ApiResponseData<T = any> {
  code: number
  msg: string
  data: T
}

interface PaginationData<T> {
  items: T[]
  total: number
  page: number
  page_size: number
}
```

## 7. 接口文档规范

### 7.1 文档内容要求

每个接口文档必须包含：
- 接口描述和用途
- 请求方法和URL
- 请求参数说明
- 响应格式示例
- 错误码说明
- 权限要求

### 7.2 示例格式

```markdown
### 获取用户列表

**接口描述**: 分页获取用户列表

**请求方式**: GET

**请求URL**: `/api/v1/users`

**权限要求**: `user:view`

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | number | 否 | 页码，默认1 |
| page_size | number | 否 | 每页数量，默认20 |

**响应示例**:
```json
{
  "code": 200,
  "msg": "获取用户列表成功",
  "data": {
    "items": [...],
    "total": 100,
    "page": 1,
    "page_size": 20
  }
}
```

**错误码**:
| 错误码 | 说明 |
|--------|------|
| 401 | 未授权访问 |
| 403 | 权限不足 |
```

## 8. 测试和验证

### 8.1 接口测试要求

- 所有接口必须通过响应格式验证
- 错误处理测试覆盖所有错误场景
- 权限控制测试验证访问控制

### 8.2 自动化测试

使用提供的测试脚本验证接口标准化：

```bash
node frontend/test-api.js
```

## 9. 迁移指南

### 9.1 现有接口迁移

1. 更新响应格式为 {code, msg, data}
2. 统一字段命名为 snake_case
3. 更新错误处理逻辑
4. 更新接口文档

### 9.2 前端适配

1. 更新API类型定义
2. 修改HTTP客户端响应处理
3. 更新错误处理逻辑
4. 测试接口兼容性

## 10. 维护和更新

### 10.1 版本控制

- 接口版本通过URL路径控制（如 /api/v1/）
- 重大变更需要新版本号
- 保持向后兼容性

### 10.2 监控和日志

- 记录接口调用日志
- 监控响应时间和错误率
- 定期检查接口规范遵循情况

---

**文档版本**: v1.0  
**最后更新**: 2025-01-01  
**维护人员**: 开发团队
